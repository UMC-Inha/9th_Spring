# 객체 그래프 탐색

  객체 그래프 탐색 : ORM 기술인 JPA와 같은 환경에서 사용되는 개념, 프로그램의 객체 모델에서 연관 관계로 연결된 객체들을 따라가면서 다른 객체를 조회하는 과정

  [예시]

    ```
    order.getMember().getAddress().getCity();
    ```

  객체 그래프 : 메모리상에서 객체들이 서로를 참조하면서 만들어지는 네트워크 구조. 객체 하나하나가 그래프의 정점이 되고, 객체 간의 연관관계가 간선이 된다

  [중요한 이유]

  1. 도메인 기반 설계인 DDD에서는 객체들이 연결되어 있으므로 상태/행동을 가져오기 위해 탐색이 필수다.
  2. ORM에서 핵심개념으로 사용된다. Lazy/Eager loading 모두 객체 그래프 탐색 시점을 언제로 할지 결정하는 것이다.
        - Lazy : 접근할 때 쿼리 실행
        - Eager : 처음부터 전부 로딩
  3. 그래프를 순회하며 JSON 변환할 때 양방한 연관관계가 있으면 무한 루프가 발생할 수 있다

  [장점]

  1. 객체 지향적 설계 가능 : SQL/DB 테이블이 아닌 객체의 참조를 통해 데이터를 조회하기 때문에 메모리에 있는 객체를 다루는 것처럼 자연스럽게 프로그래밍 가능
  2. 연관된 객체를 직접 조회 메서드로 접근할 수 있기 때문에 개발이 용이하다
  3. 연관 관계에 대한 로직이 객체 내부에 캡슐화되어 있어 응집도가 높다

  [단점]

  1. N + 1 문제 발생 가능 : JPA에서 Lazy 로딩된 객체를 반복문으로 탐색하면 추가 쿼리 발생
  2. 한 객체에서 너무 깊은 탐색을 진행하면 의존성이 복잡해지고 유지보수가 어려워진다
  3. 지연로딩은 엔티티가 영속성 컨텍스트의 관리 범위 내에 있을 때만 가능하기 때문에 범위를 벗어나서 접근하려 하면 예외 발생할 수 있다

  [올바르게 사용하는 방법]

  1. Aggregate Root 외부로 객체 그래프 노출x
  2. JPA에서는 Fetch Join 사용
  3. JSON 직렬화 할 때 @JsonIgnore, @JsonManagedReference, @JsonBackReference 혹은 DTO 변환 사용