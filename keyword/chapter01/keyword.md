### 1. DB JOIN 이란?

JOIN (인스타그램 댓글창, 아이디+댓글)
: 조인을 사용하면 두 개의 테이블을 엮어서 원하는 데이터를 추출할 수 있다.
    
→ 두 테이블의 JOIN을 위해서는 기본키와 외래키관계로 맺어져야 하고, 이를 일대다 관계
<hr>

### 2. JOIN 종류들

- INNER JOIN(내부 조인) : 두 테이블에 모두 지정한 열의 데이터 있어야함

````
SELECT <열 목록>
FROM <첫 번째 테이블>
    INNER JOIN <두 번째 테이블>
    ON <조인 조건>
[WHERE 검색 조건]
````

- OUTER JOIN(외부 조인) : 1개의 테이블에만 데이터가 있어도 결과 나옴

    - LEFT : 좌측 테이블 데이터에 추가로 우측 정보 조인(조인 불가능한 것 NULL로 채움)
    - RIGHT : 우측 테이블을 모두 살린 채로 좌측 테이블 조인
    - FULL : 좌우측 상관없이 데이터가 있는 것은 모두 가져오고 없는 것은 모두 NULL
````
SELECT <열 목록>
FROM <첫 번째 테이블(LEFT 테이블)>
    <LEFT | RIGHT | FULL> OUTER JOIN <두 번째 테이블(RIGHT 테이블)>
     ON <조인 조건>
[WHERE 검색 조건]
````

- CROSS JOIN(상호 조인) : 한쪽 테이블의 모든 행과 다른 쪽 테이블의 모든 행 조인하는 기능

````
SELECT *
FROM <첫 번째 테이블>
    CROSS JOIN <두 번째 테이블>
````

- SELF JOIN(자체 조인) : 자신이 자신과 조인한다는 의미, 1개의 테이블 사용

````
SELECT <열 목록>
FROM <테이블> 별칭A
    INNER JOIN <테이블> 별칭B
[WHERE 검색 조건]
````

<hr>

### 3. 트랜잭션이란?

#### [정의]

하나의 데이터 교환 또는 변경을 안전하게 처리하도록 보장해 주는 것

→ 한 번의 애플리케이션 로직으로 두 개 이상의 데이터가 영향을 받는 경우, 각각의 데이터에 대한 변경이 완전하게 끝난 후 데이터베이스에 정상적으로 반영하는 것

정상적으로 반영하는 것 : 커밋, 되돌리는 것 : 롤백

#### [트랜잭션 동작 원리]

→ 트랜잭션 기능 사용 시, 세션 내에서 동작

![imgage (1).png](image%20(1).png)

1. 사용자는 클라이언트를 사용해서 데이터베이스 서버에 접근할 수 있다.
2. 클라이언트는 데이터 베이스 서버에 연결을 요청하고 커넥션을 맺는다.
3. 데이터베이스 서버는 내부에 세션을 만들어서 세션을 통해 커넥션을 통한 요청을 실행

이후 커밋을 한다면 세션 종류 후 DB에 결과 반영, 롤백을 한다면 세션  시작 이전으로 되돌림

#### [트랜잭션 과정]

1. 자동 커밋 해제
  - 기본적으로 DB는 자동커밋으로 설정되어 있다. 트랜잭션은 즉각적으로 반영되지 않도록 하는 것이기 때문에 수동 커밋 모드로 변경하는 것이 트랜잭션의 시작이다.

````
set autocommit false; // 수동커밋 모드로 설정
# set autocommit true; //자동 커밋 모드로 설정
````

2. 쿼리 실행
- 수동커밋 모드로 변경 후 쿼리 실행한다. 실행한 쿼리는 해당 세션 내에서만 동작. 따라서 다른 세션에서 DB를 조회했을 때는 쿼리 실행 전의 상태 볼 수 있다.

3. 커밋 혹은 롤백
- 문제 없이 두 개의 쿼리가 실행되었다면 커밋, 문제가 발생했다면 롤백을 진행


#### [트랜잭션 상태]

![image2 (2).png](image%20(2).png)

- Active : 트랜잭션 활동 상태, 트랜잭션이 실행 중
- Partially Committed : 트랜잭션의 Commit 명령이 도착한 상태
- Failed : 트랜잭션 실패 상태. 더 이상 트랜잭션이 정상 진행될 수 없는 상태
- Committed : 트랜잭션 완료 상태
- Aborted : 트랜잭션 취소 상태


#### [트랙잭션 ACID 속성]
(ACID : 트랜잭션을 정의하는 4가지 중대한 속성을 가리키는 약어)

- 원자성(Atomicity) : 트랙잭션 내에서 실행한 작업들은 마치 하나의 작업인 것처럼 모두 성공하거나 모두 실패해야 한다. (모두 성공시 커밋, 하나라도 실패 시 롤백)
- 일관성(Consistency) : 모든 트랜잭션은 일관성 있는 데이터베이스 상태를 유지해야 한다.
- 격리성(Isolation) : 동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리해야 한다. ex) 동시에 같은 데이터를 수정하지 못하도록 해야한다.
- 영속성(Durability) : 트랜잭션을 성공적으로 끝내면 그 결과가 항상 기록되어야 한다. 중간에 시스템에 문제가 발생되면 데이터베이스 로그 등을 사용해 복구해야 한다.

#### [용어정리]

커밋 : 지금까지 작업한 내용을 DB에 영구적으로 저장한다(트랜잭션 종료)

롤백 : 지금까지 작업들을 모두 취소하고 트랜잭션 이전 상태로 되돌린다(트랜잭션 종료)

<hr>

### 4. JOIN ON과 WHERE의 차이

JOIN ON : join(결합)이 이루어지긴 전에 적용. 결합할 행을 결정하는데 사용

JOIN WHERE : on절을 통해 테이블이 결합된 후에 적용

#### [차이점]

JOIN ON

- 결합 조건과 필터링 조건이 분리됨 (ON절 : 테이블 간의 연결조건,  WHERE절 : 최종 결과 필터링)

JOIN WHERE

- 결합 조건과 필터링 조건이 혼합됨 (WHERE절: 두 가지 역할을 모두 수행)

1. INNER JOIN:
   두 방식 모두 정확한 결과가 나온다. 대부분 가독성과 표준 문법을 위해 JOIN ON을 사용하는 것이 권장됨
2. OUTER JOIN:
   JOIN ON과 JOIN WHERE의 역할이 완전히 다르게 작동하기 때문에 무조건 JOIN ON을 사용해야 함. OUTER JOIN의 본래 목적(결합 조건에 맞지 않아도 한쪽 테이블의 모든 행을 보존하는 것)을 달성할 수 있다.

→ WHERE 절에 결합 조건을 넣게 되면 INNER JOIN과 동일한 결과가 나오게 됩니다.

#### [장단점]

JOIN ON

- 높은 가독성(결합과 필터링 명확하기 때문)
- 유지보수 용이(조건 변경 시 혼란 적음)
- 표준문법 준수
- 성능 최적화 유리
- INNER JOIN의 경우 코드가 길어질 수 있음

JOIN WHERE

- 간결함
- 낮은 가독성(WHERE 절에 너무 많은 조건 들어감)
- 제한적인 기능(OUTER JOIN 시 사용하지 못한다)